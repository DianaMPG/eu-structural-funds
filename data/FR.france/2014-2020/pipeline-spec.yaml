2014-2020:
  pipeline:
    - run: read_description
      validate: true
      parameters:
        save_datapackage: false

    - run: stream_from_path
      validate: true
      parameters:
        streamer: tabulator
        format: xls

    - run: dump
      parameters:
        out-file: source.datapackage.zip

    - run: map_columns

    - run: show_sample_in_console
      parameters:
        sample_size: 10000000

    - run: convert_excel_dates
      parameters:
        date-mode: 0
        date-fields:
          - starting_date
          - completion_date
          - approval_date

    - run: cast_to_fiscal_schema

    - run: reshape_data

    - run: load_fiscal_datapackage

    - run: nop
      validate: true

    - run: show_sample_in_console
      parameters:
        sample_size: 10000000

    - run: dump
      parameters:
        out-file: fiscal.datapackage.zip

    - run: fiscal.upload
      parameters:
        in-file: fiscal.datapackage.zip

  schedule:
    crontab: 0 0 1 1 *
